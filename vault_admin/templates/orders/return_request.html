<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Return Requests | AZRION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'navy': '#16213e',
                        'navy-dark': '#0f1729',
                        'light-gray': '#f8f9fa',
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
        .table-row:hover {
            background-color: #f8f9fa;
        }
        .status-badge {
            transition: all 0.2s ease;
        }
        .action-badge {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .action-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .btn-primaryy {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            background: #16213e;
            border: none;
            border-radius: 8px;
        }
        .btn-primaryy::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        .btn-primaryy:hover::before {
            left: 100%;
        }
        .btn-primaryy:hover {
            background: linear-gradient(135deg, rgb(51, 59, 82), rgb(39, 52, 87));
            transform: translateY(-2px);
        }

        /* Compact Modal Styles */
        .modal-overlay {
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease-out;
        }
        .modal-content {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        /* Sticky Navigation and Sidebar Styles */
        .sticky-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 40;
        }
        .sticky-sidebar {
            position: fixed;
            top: 64px;
            left: 0;
            height: calc(100vh - 64px);
            z-index: 30;
        }
        .main-content-with-nav {
            margin-top: 64px;
        }

        /* Compact scrollbar styles */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
            transition: background 0.3s ease;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.4);
        }

        /* Compact table */
        .table-container {
            max-height: calc(100vh - 250px);
            overflow-y: auto;
        }

        /* Compact Modal Styles */
        .custom-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .custom-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .custom-modal-content {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 350px;
            width: 90%;
            text-align: center;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .custom-modal.active .custom-modal-content {
            transform: translateY(0);
        }

        .custom-modal h4 {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }

        .custom-modal p {
            font-size: 0.9rem;
            color: #4b5563;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .custom-modal-buttons {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
        }

        .custom-btn-secondary, .custom-btn-danger, .custom-btn-success {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .custom-btn-secondary {
            border: 1px solid #6b7280;
            color: #6b7280;
            background: white;
        }

        .custom-btn-secondary:hover {
            background: #6b7280;
            color: white;
        }

        .custom-btn-danger {
            background: #dc2626;
            color: white;
            border: none;
        }

        .custom-btn-danger:hover {
            background: #b91c1c;
        }

        .custom-btn-success {
            background: #16a34a;
            color: white;
            border: none;
        }

        .custom-btn-success:hover {
            background: #15803d;
        }

        /* Compact type badge styles */
        .type-badge {
            padding: 1px 6px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .type-item { background: #dbeafe; color: #1e40af; }
        .type-order { background: #f3e8ff; color: #7c3aed; }

        /* Compact table styles */
        .compact-table th {
            padding: 0.5rem 0.75rem;
            font-size: 0.75rem;
        }
        
        .compact-table td {
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
        }

        @media (max-width: 768px) {
            .table-container {
                overflow-x: auto;
            }
            .custom-modal-content {
                width: 95%;
                margin: 0 2.5%;
                padding: 1rem;
            }
            .sticky-sidebar {
                top: 64px;
                height: calc(100vh - 64px);
            }
        }

        @media (min-width: 768px) {
            .main-content-area-wrapper {
                margin-left: 16rem;
                width: calc(100vw - 16rem);
                overflow-x: hidden;
            }
        }
    </style>
</head>
<body class="bg-light-gray min-h-screen">
    {% include 'nav.html' %}
    
    <div class="flex main-content-with-nav">
        <div class="main-content-area-wrapper">
            <div class="p-3 md:p-4 max-w-7xl mx-auto">
                <!-- Messages Display -->
                {% if messages %}
                    <div class="mb-4">
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} mb-2 p-3 rounded-lg border-l-4 {% if message.tags == 'success' %}bg-green-50 border-green-400 text-green-700{% elif message.tags == 'error' %}bg-red-50 border-red-400 text-red-700{% elif message.tags == 'warning' %}bg-yellow-50 border-yellow-400 text-yellow-700{% else %}bg-blue-50 border-blue-400 text-blue-700{% endif %}">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        {% if message.tags == 'success' %}
                                            <i class="fas fa-check-circle text-sm"></i>
                                        {% elif message.tags == 'error' %}
                                            <i class="fas fa-exclamation-circle text-sm"></i>
                                        {% elif message.tags == 'warning' %}
                                            <i class="fas fa-exclamation-triangle text-sm"></i>
                                        {% else %}
                                            <i class="fas fa-info-circle text-sm"></i>
                                        {% endif %}
                                    </div>
                                    <div class="ml-2">
                                        <p class="text-sm font-medium">{{ message }}</p>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                <!-- Compact Header -->
                <div class="mb-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-navy mb-1">Return Requests</h2>
                            <p class="text-sm text-gray-600">Manage product return requests</p>
                        </div>
                        <a href="{% url 'order_management_page' %}" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded-lg transition-all text-sm">
                            <i class="fas fa-arrow-left mr-1"></i>Back to Orders
                        </a>
                    </div>
                </div>

                <!-- Compact Filter Form -->
                <div class="bg-white rounded-lg shadow-md p-4 mb-4">
                    <form method="get" action="{% url 'return_requests_page' %}" class="flex items-center gap-3 flex-wrap">
                        <select name="status" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy focus:border-transparent text-sm">
                            <option value="all" {% if status_filter == 'all' %}selected{% endif %}>All Status</option>
                            <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending</option>
                            <option value="approved" {% if status_filter == 'approved' %}selected{% endif %}>Approved</option>
                            <option value="rejected" {% if status_filter == 'rejected' %}selected{% endif %}>Rejected</option>
                        </select>
                        
                        <select name="type" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy focus:border-transparent text-sm">
                            <option value="all" {% if request_type == 'all' %}selected{% endif %}>All Types</option>
                            <option value="item" {% if request_type == 'item' %}selected{% endif %}>Individual Items</option>
                            <option value="order" {% if request_type == 'order' %}selected{% endif %}>Full Orders</option>
                        </select>
                        
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg transition-all text-sm">
                            <i class="fas fa-filter mr-1"></i>Filter
                        </button>
                        
                        {% if status_filter != 'all' or request_type != 'all' %}
                        <button type="button" onclick="window.location.href='{% url 'return_requests_page' %}'"
                                class="bg-gray-500 hover:bg-gray-600 text-white font-semibold px-3 py-2 rounded-lg transition-all text-sm">
                            <i class="fas fa-times mr-1"></i>Clear
                        </button>
                        {% endif %}
                    </form>
                </div>

                <!-- Compact Return Requests Table -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="table-container">
                        <table class="min-w-full bg-white compact-table">
                            <thead class="bg-gray-200 sticky top-0">
                                <tr>
                                    <th class="py-2 px-3 text-left text-xs font-semibold text-gray-700">Type</th>
                                    <th class="py-2 px-3 text-left text-xs font-semibold text-gray-700">Order</th>
                                    <th class="py-2 px-3 text-left text-xs font-semibold text-gray-700">Customer</th>
                                    <th class="py-2 px-3 text-left text-xs font-semibold text-gray-700">Item</th>
                                    <th class="py-2 px-3 text-left text-xs font-semibold text-gray-700">Reason</th>
                                    <th class="py-2 px-3 text-left text-xs font-semibold text-gray-700">Status</th>
                                    <th class="py-2 px-3 text-left text-xs font-semibold text-gray-700">Date</th>
                                    <th class="py-2 px-3 text-left text-xs font-semibold text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for return_request in return_requests %}
                                <tr class="border-t hover:bg-gray-50">
                                    <td class="py-2 px-3">
                                        <span class="type-badge type-{{ return_request.type }}">
                                            {% if return_request.type == 'item' %}
                                                <i class="fas fa-box mr-1"></i>Item
                                            {% else %}
                                                <i class="fas fa-shopping-cart mr-1"></i>Order
                                            {% endif %}
                                        </span>
                                    </td>
                                    <td class="py-2 px-3">
                                        <div class="font-semibold text-navy text-sm">{{ return_request.order_number }}</div>
                                        <div class="text-xs text-gray-500">₹{{ return_request.item_total|floatformat:0 }}</div>
                                    </td>
                                    <td class="py-2 px-3">
                                        <div class="font-medium text-sm">{{ return_request.customer_name }}</div>
                                        <div class="text-xs text-gray-500">{{ return_request.customer_email|truncatechars:20 }}</div>
                                    </td>
                                    <td class="py-2 px-3">
                                        <div class="font-medium text-sm">{{ return_request.product_name|truncatechars:15 }}</div>
                                        {% if return_request.variant_color %}
                                            <div class="text-xs text-gray-500">{{ return_request.variant_color }} • {{ return_request.quantity }}</div>
                                        {% else %}
                                            <div class="text-xs text-gray-500">{{ return_request.quantity }} item{{ return_request.quantity|pluralize }}</div>
                                        {% endif %}
                                    </td>
                                    <td class="py-2 px-3">
                                        <div class="max-w-xs truncate text-sm">{{ return_request.reason|truncatechars:30 }}</div>
                                    </td>
                                    <td class="py-2 px-3">
                                        {% if return_request.status == 'pending' %}
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                                <i class="fas fa-clock mr-1"></i>Pending
                                            </span>
                                        {% elif return_request.status == 'approved' %}
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                <i class="fas fa-check-circle mr-1"></i>Approved
                                            </span>
                                        {% else %}
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                <i class="fas fa-times-circle mr-1"></i>Rejected
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td class="py-2 px-3">
                                        <div class="text-xs">{{ return_request.requested_at|date:"M d" }}</div>
                                        <div class="text-xs text-gray-500">{{ return_request.requested_at|date:"g:i A" }}</div>
                                    </td>
                                    <td class="py-2 px-3">
                                        {% if return_request.status == 'pending' %}
                                        <button onclick="openReturnModal('{{ return_request.type }}', '{{ return_request.id }}', '{{ return_request.order_number }}', '{{ return_request.product_name }}', '{{ return_request.reason|escapejs }}', '{{ return_request.item_total }}')" 
                                                class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs transition-all">
                                            <i class="fas fa-eye mr-1"></i>Review
                                        </button>
                                        {% else %}
                                        <span class="text-gray-500 text-xs">Processed</span>
                                        {% if return_request.processed_by %}
                                            <div class="text-xs text-gray-400">{{ return_request.processed_by.full_name|truncatechars:10 }}</div>
                                        {% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="8" class="text-center py-8 text-gray-500">
                                        <i class="fas fa-undo text-4xl text-gray-300 mb-2"></i>
                                        <p class="text-sm">No return requests found.</p>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Compact Pagination -->
                {% if return_requests.has_other_pages %}
                <div class="flex justify-center mt-4">
                    <nav class="inline-flex rounded-md shadow-sm">
                        {% if return_requests.has_previous %}
                            <a href="?{% if status_filter != 'all' %}status={{ status_filter }}&{% endif %}{% if request_type != 'all' %}type={{ request_type }}&{% endif %}page={{ return_requests.previous_page_number }}"
                               class="px-2 py-1 bg-white border border-gray-300 text-xs font-medium text-gray-700 hover:bg-gray-100 rounded-l-md">
                                Previous
                            </a>
                        {% endif %}
                        
                        {% for num in return_requests.paginator.page_range %}
                            {% if return_requests.number == num %}
                                <span class="px-2 py-1 border border-blue-600 bg-blue-600 text-white text-xs font-semibold">
                                    {{ num }}
                                </span>
                            {% else %}
                                <a href="?{% if status_filter != 'all' %}status={{ status_filter }}&{% endif %}{% if request_type != 'all' %}type={{ request_type }}&{% endif %}page={{ num }}"
                                   class="px-2 py-1 border border-gray-300 bg-white text-xs font-medium text-gray-700 hover:bg-gray-100">
                                    {{ num }}
                                </a>
                            {% endif %}
                        {% endfor %}
                        
                        {% if return_requests.has_next %}
                            <a href="?{% if status_filter != 'all' %}status={{ status_filter }}&{% endif %}{% if request_type != 'all' %}type={{ request_type }}&{% endif %}page={{ return_requests.next_page_number }}"
                               class="px-2 py-1 bg-white border border-gray-300 text-xs font-medium text-gray-700 hover:bg-gray-100 rounded-r-md">
                                Next
                            </a>
                        {% endif %}
                    </nav>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Compact Return Request Review Modal -->
    <div id="returnModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">Review Return Request</h3>
                    <form id="returnForm" method="post">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Request Type</label>
                            <p id="returnType" class="text-sm text-gray-600 bg-gray-50 p-2 rounded"></p>
                        </div>
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Order Number</label>
                            <p id="returnOrderNumber" class="text-sm text-gray-600 bg-gray-50 p-2 rounded"></p>
                        </div>
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Item Details</label>
                            <p id="returnItemDetails" class="text-sm text-gray-600 bg-gray-50 p-2 rounded"></p>
                        </div>
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Refund Amount</label>
                            <p id="returnAmount" class="text-sm text-gray-600 bg-gray-50 p-2 rounded font-semibold"></p>
                        </div>
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Return Reason</label>
                            <p id="returnReason" class="text-sm text-gray-600 bg-gray-50 p-2 rounded max-h-20 overflow-y-auto"></p>
                        </div>
                        <div class="mb-3">
                            <label for="adminNotes" class="block text-sm font-medium text-gray-700 mb-1">Admin Notes (Optional)</label>
                            <textarea id="adminNotes" name="admin_notes" rows="2" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-navy focus:border-transparent text-sm" 
                                      placeholder="Add any notes about this decision..."></textarea>
                        </div>
                        <div class="flex justify-end gap-2">
                            <button type="button" onclick="closeReturnModal()" 
                                    class="px-3 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-all text-sm">
                                Cancel
                            </button>
                            <button type="button" id="rejectBtn" 
                                    class="px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all text-sm">
                                <i class="fas fa-times mr-1"></i>Reject
                            </button>
                            <button type="button" id="approveBtn" 
                                    class="px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all text-sm">
                                <i class="fas fa-check mr-1"></i>Approve
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Compact Custom Confirmation Modal -->
    <div id="confirmModal" class="custom-modal">
        <div class="custom-modal-content">
            <h4 id="confirmTitle">Confirm Action</h4>
            <p id="confirmMessage">Are you sure you want to proceed?</p>
            <div class="custom-modal-buttons">
                <button type="button" onclick="closeConfirmModal()" class="custom-btn-secondary">Cancel</button>
                <button type="button" id="confirmActionBtn" class="custom-btn-danger">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        let currentReturnRequestId = null;
        let currentReturnType = null;
        let currentAction = null;

        function openReturnModal(type, requestId, orderNumber, itemDetails, reason, amount) {
            currentReturnRequestId = requestId;
            currentReturnType = type;
            
            document.getElementById('returnModal').classList.remove('hidden');
            document.getElementById('returnType').textContent = type === 'item' ? 'Individual Item Return' : 'Full Order Return';
            document.getElementById('returnOrderNumber').textContent = orderNumber;
            document.getElementById('returnItemDetails').textContent = itemDetails;
            document.getElementById('returnAmount').textContent = '₹' + parseFloat(amount).toFixed(0);
            document.getElementById('returnReason').textContent = reason;
            
            // Set the correct form action based on type
            if (type === 'item') {
                document.getElementById('returnForm').action = "{% url 'verify_item_return_request' 0 %}".replace('0', requestId);
            } else {
                document.getElementById('returnForm').action = "{% url 'verify_return_request' 0 %}".replace('0', requestId);
            }
            
            // Clear any previous admin notes
            document.getElementById('adminNotes').value = '';
            
            // Focus on the modal for better UX
            setTimeout(() => {
                document.getElementById('adminNotes').focus();
            }, 300);
        }

        function closeReturnModal() {
            document.getElementById('returnModal').classList.add('hidden');
            document.getElementById('adminNotes').value = '';
            currentReturnRequestId = null;
            currentReturnType = null;
        }

        function showConfirmModal(title, message, action, buttonText, buttonClass) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmActionBtn').textContent = buttonText;
            document.getElementById('confirmActionBtn').className = `custom-btn-${buttonClass}`;
            document.getElementById('confirmModal').classList.add('active');
            currentAction = action;
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
            currentAction = null;
        }

        function executeAction() {
            if (currentAction === 'approve') {
                submitForm('approve');
            } else if (currentAction === 'reject') {
                const adminNotes = document.getElementById('adminNotes').value.trim();
                if (!adminNotes) {
                    closeConfirmModal();
                    showCustomAlert('Please provide admin notes explaining why this return request is being rejected.');
                    document.getElementById('adminNotes').focus();
                    return;
                }
                submitForm('reject');
            }
            closeConfirmModal();
        }

        function submitForm(action) {
            const form = document.getElementById('returnForm');
            
            // Create hidden input for action
            const actionInput = document.createElement('input');
            actionInput.type = 'hidden';
            actionInput.name = 'action';
            actionInput.value = action;
            form.appendChild(actionInput);
            
            // Show loading state
            const submitButton = action === 'approve' ? document.getElementById('approveBtn') : document.getElementById('rejectBtn');
            const originalText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>Processing...';
            
            // Submit form
            form.submit();
        }

        function showCustomAlert(message) {
            showConfirmModal('Alert', message, null, 'OK', 'secondary');
            // Hide the confirm button and only show OK
            document.getElementById('confirmActionBtn').onclick = closeConfirmModal;
        }

        // Event listeners
        document.getElementById('approveBtn').addEventListener('click', function() {
            const orderNumber = document.getElementById('returnOrderNumber').textContent;
            const itemDetails = document.getElementById('returnItemDetails').textContent;
            const amount = document.getElementById('returnAmount').textContent;
            const typeText = currentReturnType === 'item' ? 'item return' : 'full order return';
            
            showConfirmModal(
                'Approve Return Request',
                `Are you sure you want to approve the ${typeText} for ${itemDetails} from order ${orderNumber}? This will refund ${amount} to the customer and cannot be undone.`,
                'approve',
                'Yes, Approve & Refund',
                'success'
            );
        });

        document.getElementById('rejectBtn').addEventListener('click', function() {
            const orderNumber = document.getElementById('returnOrderNumber').textContent;
            const itemDetails = document.getElementById('returnItemDetails').textContent;
            const adminNotes = document.getElementById('adminNotes').value.trim();
            const typeText = currentReturnType === 'item' ? 'item return' : 'full order return';
            
            if (!adminNotes) {
                showCustomAlert('Please provide admin notes explaining why this return request is being rejected.');
                document.getElementById('adminNotes').focus();
                return;
            }
            
            showConfirmModal(
                'Reject Return Request',
                `Are you sure you want to reject the ${typeText} for ${itemDetails} from order ${orderNumber}?`,
                'reject',
                'Yes, Reject',
                'danger'
            );
        });

        document.getElementById('confirmActionBtn').addEventListener('click', executeAction);

        // Close modals when clicking outside
        document.getElementById('returnModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeReturnModal();
            }
        });

        document.getElementById('confirmModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeConfirmModal();
            }
        });

        // Close modals with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeReturnModal();
                closeConfirmModal();
            }
        });

        // Set active navigation item
        function setActiveNavItem(currentPage) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('bg-navy');
                link.classList.add('hover:bg-navy');
            });
            const activeLink = document.querySelector(`[data-page="${currentPage}"]`);
            if (activeLink) {
                activeLink.classList.add('bg-navy');
                activeLink.classList.remove('hover:bg-navy');
            }
        }

        // Auto-detect current page and set active state
        document.addEventListener('DOMContentLoaded', function() {
            setActiveNavItem('orders');
            
            // Auto-hide messages after 5 seconds
            const messages = document.querySelectorAll('.alert');
            messages.forEach(function(message) {
                setTimeout(function() {
                    message.style.transition = 'opacity 0.5s ease-out';
                    message.style.opacity = '0';
                    setTimeout(function() {
                        message.remove();
                    }, 500);
                }, 5000);
            });
        });
    </script>
</body>
</html>
